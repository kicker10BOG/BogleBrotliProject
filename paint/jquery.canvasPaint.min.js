// canvasPaint Plugin: 0.5.0
function CanvasPaintObjectFactory(t){var e=this;e.owner=t,e.drawingObject=function(t,e){return e.tool=t.tool,e.id=t.id,e.order=t.order,e.layer=t.layer,e.erased=[],e.genCanvas=function(){e.bigCanvas=$("<canvas>").attr({height:e.layer.manager.owner.options.canvHeight,width:e.layer.manager.owner.options.canvWidth}).addClass("canvasPaintObjectCanvas").css("z-index",1e3*e.layer.order+e.order),e.layer.manager.owner.canvasDiv.append(e.bigCanvas),e.bigContext=e.bigCanvas[0].getContext("2d")},e.genCanvas(),e.delCanvas=function(){this.bigCanvas.remove(),delete this.bigContext},e.drawOnContextAsImg=function(t){this.draw(),t.drawImage(this.bigCanvas[0],0,0)},e.show=function(){this.bigCanvas.show()},e.hide=function(){this.bigCanvas.hide()},e.setOrder=function(t){this.order=t,this.bigCanvas.css("z-index",1e3*this.layer.order+t)},e.setLayerOrder=function(){this.setOrder(this.order)},e.computeVisualBounds=function(){var t,e,a,o=this.bounds.points,n=this.bounds.visual,i=this.bigContext.getImageData(o.left,o.top,o.right-o.left,o.bottom-o.top),s=i.height,r=i.width,l=i.data;for(a=!1,t=0;r>t&&!a;t++)for(e=0;s>e&&!a;e++)l[4*(e*r+t)+3]>0&&(n.left=t+o.left,a=!0);for(a=!1,e=0;s>e&&!a;e++)for(t=0;r>t&&!a;t++)l[4*(e*r+t)+3]>0&&(n.top=e+o.top,a=!0);for(a=!1,t=r-1;t>0&&!a;t--)for(e=0;s>e&&!a;e++)l[4*(e*r+t)+3]>0&&(n.right=t+o.left,a=!0);for(a=!1,e=s-1;e>0&&!a;e--)for(t=0;r>t&&!a;t++)l[4*(e*r+t)+3]>0&&(n.bottom=e+o.top,a=!0)},e.drawPointsBoundingBox=function(){this.bigContext.setLineDash([6]),this.bigContext.lineWidth=4,this.bigContext.strokeStyle="#000000",this.bigContext.beginPath(),this.bigContext.globalCompositeOperation="source-over",this.bigContext.rect(this.bounds.points.left,this.bounds.points.top,this.bounds.points.right-this.bounds.points.left,this.bounds.points.bottom-this.bounds.points.top),this.bigContext.stroke(),this.bigContext.setLineDash([0])},e.drawVisualBoundingBox=function(){this.bigContext.setLineDash([6]),this.bigContext.lineWidth=4,this.bigContext.strokeStyle="#000000",this.bigContext.beginPath(),this.bigContext.globalCompositeOperation="source-over",this.bigContext.rect(this.bounds.visual.left,this.bounds.visual.top,this.bounds.visual.right-this.bounds.visual.left,this.bounds.visual.bottom-this.bounds.visual.top),this.bigContext.stroke(),this.bigContext.setLineDash([0])},this},e.paintObject=function(t){return e.drawingObject(t,this),this.type="paint",this.strokes=[],this.strokes.push({points:[{x:t.mX,y:t.mY}],tool:t.tool,strokeColor:e.owner.TM.strokeColor,strokeWidth:e.owner.TM.strokeWidth,strokeOpacity:e.owner.TM.strokeOpacity,bounds:{left:t.mX-e.owner.TM.strokeWidth/2,top:t.mY-e.owner.TM.strokeWidth/2,right:t.mX+e.owner.TM.strokeWidth/2,bottom:t.mY+e.owner.TM.strokeWidth/2}}),this.bounds={points:{},visual:{}},this.bounds.points.left=t.mX-this.strokes[0].strokeWidth/2,this.bounds.points.top=t.mY-this.strokes[0].strokeWidth/2,this.bounds.points.right=t.mX+this.strokes[0].strokeWidth/2,this.bounds.points.bottom=t.mY+this.strokes[0].strokeWidth/2,this.bounds.visual.left=t.mX-this.strokes[0].strokeWidth/2,this.bounds.visual.top=t.mY-this.strokes[0].strokeWidth/2,this.bounds.visual.right=t.mX+this.strokes[0].strokeWidth/2,this.bounds.visual.bottom=t.mY+this.strokes[0].strokeWidth/2,this.addPoint=function(t){if(t.dragging){var a=this.strokes[this.strokes.length-1];a.points.push({x:t.mX,y:t.mY});var o=a.strokeWidth/2;t.mX-o<a.bounds.left&&(a.bounds.left=t.mX-o),t.mY-o<a.bounds.top&&(a.bounds.top=t.mY-o),t.mX+o>a.bounds.right&&(a.bounds.right=t.mX+o),t.mY+o>a.bounds.bottom&&(a.bounds.bottom=t.mY+o)}else this.isBlank=!1,this.strokes.push({points:[{x:t.mX,y:t.mY}],tool:t.tool,strokeColor:e.owner.TM.strokeColor,strokeWidth:e.owner.TM.strokeWidth,strokeOpacity:e.owner.TM.strokeOpacity,bounds:{left:t.mX-e.owner.TM.strokeWidth/2,top:t.mY-e.owner.TM.strokeWidth/2,right:t.mX+e.owner.TM.strokeWidth/2,bottom:t.mY+e.owner.TM.strokeWidth/2}});return this.strokes[this.strokes.length-1]},this.addErasePoint=function(t){return this.addPoint(t)},this.undoErase=function(){this.strokes.pop(),this.isBlank=!1},this.redoErase=function(t){this.strokes.push(t)},this.draw=function(){if(!this.isBlank){this.bigContext.clearRect(0,0,this.bigContext.canvas.width,this.bigContext.canvas.height),this.bigContext.lineJoin="round",this.bigContext.lineCap="round";for(var t=0;t<this.strokes.length;t++){this.bigContext.beginPath(),this.bigContext.strokeStyle=this.strokes[t].strokeColor,this.bigContext.globalAlpha=this.strokes[t].strokeOpacity*this.layer.opacity,this.bigContext.lineWidth=this.strokes[t].strokeWidth,"paint"==this.strokes[t].tool?this.bigContext.globalCompositeOperation="source-over":"eraser"==this.strokes[t].tool&&(this.bigContext.globalCompositeOperation="destination-out");for(var a=0;a<this.strokes[t].points.length;a++)0==a&&(this.bigContext.moveTo(this.strokes[t].points[a].x,this.strokes[t].points[a].y),this.bigContext.lineTo(this.strokes[t].points[a].x+.001,this.strokes[t].points[a].y)),this.bigContext.lineTo(this.strokes[t].points[a].x,this.strokes[t].points[a].y);this.bigContext.stroke()}this.layer.previewContext.drawImage(this.bigCanvas[0],0,0),this.bigCanvas[0].toDataURL()==e.owner.LM.blankData&&(this.isBlank=!0)}},this.computePointsBounds=function(){var t=(this.bigContext,this.bounds.points);t.left=void 0,t.top=void 0,t.right=void 0,t.bottom=void 0,this.strokes.forEach(function(e){"paint"==e.tool&&((!t.left||e.bounds.left<t.left)&&(t.left=e.bounds.left),(!t.top||e.bounds.top<t.top)&&(t.top=e.bounds.top),(!t.right||e.bounds.right>t.right)&&(t.right=e.bounds.right),(!t.bottom||e.bounds.bottom>t.bottom)&&(t.bottom=e.bounds.bottom))})},this},e.rectangleObject=function(t){return e.drawingObject(t,this),this.type="rectangle",this.fillColor=e.owner.TM.fillColor,this.fillOpacity=e.owner.TM.fillOpacity,this.outlineColor=e.owner.TM.outlineColor,this.outlineColor=e.owner.TM.outlineColor,this.outlineWidth=e.owner.TM.outlineWidth,this.outlineOpacity=e.owner.TM.outlineOpacity,this.points={p1:{x:t.mX,y:t.mY},p2:{x:t.mX,y:t.mY},topLeft:{x:t.mX,y:t.mY},height:1e-5,width:1e-5},this.bounds={points:{},visual:{}},this.erased={strokes:[]},this.updateShape=function(t){this.isBlank=!1,this.points.p2.x=t.mX,this.points.p2.y=t.mY,this.points.topLeft.x=Math.min(this.points.p1.x,this.points.p2.x),this.points.topLeft.y=Math.min(this.points.p1.y,this.points.p2.y),this.points.width=Math.max(this.points.p1.x,this.points.p2.x)-this.points.topLeft.x,this.points.height=Math.max(this.points.p1.y,this.points.p2.y)-this.points.topLeft.y},this.addErasePoint=function(t){if(t.dragging){var a=this.erased.strokes[this.erased.strokes.length-1];a.points.push({x:t.mX,y:t.mY})}else this.erased.strokes.push({points:[{x:t.mX,y:t.mY}],strokeWidth:e.owner.TM.strokeWidth,strokeOpacity:e.owner.TM.strokeOpacity});return this.erased.strokes[this.erased.strokes.length-1]},this.undoErase=function(){this.erased.strokes.pop(),this.isBlank=!1},this.redoErase=function(t){this.erased.strokes.push(t)},this.draw=function(){if(!this.isBlank){var t=this.bigContext;t.clearRect(0,0,this.bigContext.canvas.width,this.bigContext.canvas.height);var a=parseInt(this.outlineWidth);this.fillOpacity>0&&(t.globalCompositeOperation="source-over",t.fillStyle=this.fillColor,t.globalAlpha=this.fillOpacity*this.layer.opacity,t.fillRect(this.points.topLeft.x,this.points.topLeft.y,this.points.width,this.points.height)),a*this.outlineOpacity>0&&(t.strokeStyle=this.outlineColor,t.lineWidth=a,t.globalAlpha=this.outlineOpacity*this.layer.opacity,t.lineJoin="miter",t.lineCap="butt",t.strokeRect(this.points.topLeft.x-a/2,this.points.topLeft.y-a/2,this.points.width+a,this.points.height+a)),t.globalCompositeOperation="destination-out",this.erased.strokes.forEach(function(e){t.beginPath(),t.lineWidth=e.strokeWidth,t.globalAlpha=e.strokeOpacity,t.lineJoin="round",t.lineCap="round";for(var a=0;a<e.points.length;a++)0==a&&(t.moveTo(e.points[a].x,e.points[a].y),t.lineTo(e.points[a].x+.001,e.points[a].y)),t.lineTo(e.points[a].x,e.points[a].y);t.stroke()}),this.layer.previewContext.drawImage(this.bigCanvas[0],0,0),this.bigCanvas[0].toDataURL()==e.owner.LM.blankData&&(this.isBlank=!0)}},this.computePointsBounds=function(){var t=(this.bigContext,this.bounds.points);t.left=this.points.topLeft.x,t.top=this.points.topLeft.y,t.right=this.points.topLeft.x+this.points.width,t.bottom=this.points.topLeft.y+this.points.height},this},e.ovalObject=function(t){return e.drawingObject(t,this),this.type="rectangle",this.fillColor=e.owner.TM.fillColor,this.fillOpacity=e.owner.TM.fillOpacity,this.outlineColor=e.owner.TM.outlineColor,this.outlineColor=e.owner.TM.outlineColor,this.outlineWidth=e.owner.TM.outlineWidth,this.outlineOpacity=e.owner.TM.outlineOpacity,this.scale={fill:{horizontal:1,vertical:1},outline:{horizontal:1,vertical:1}},this.radius={fill:1e-6,outline:1e-6},this.points={p1:{x:t.mX,y:t.mY},p2:{x:t.mX,y:t.mY},center:{x:t.mX,y:t.mY}},this.bounds={points:{},visual:{}},this.erased={strokes:[]},this.updateShape=function(t){this.isBlank=!1,this.points.p2.x=t.mX,this.points.p2.y=t.mY,this.points.center.x=Math.min(this.points.p1.x,this.points.p2.x)+Math.abs(this.points.p1.x-this.points.p2.x)/2,this.points.center.y=Math.min(this.points.p1.y,this.points.p2.y)+Math.abs(this.points.p1.y-this.points.p2.y)/2,this.radius.fill=Math.min(Math.abs(this.points.p1.x-this.points.center.x),Math.abs(this.points.p1.y,this.points.center.y)),this.radius.outline=Math.min(Math.max(this.points.p1.x,this.points.p2.x)+this.outlineWidth/2-this.points.center.x,Math.max(this.points.p1.y,this.points.p2.y)+this.outlineWidth/2-this.points.center.y),this.scale.fill.horizontal=Math.abs(this.points.p1.x-this.points.center.x)/this.radius.fill,this.scale.fill.vertical=Math.abs(this.points.p1.y-this.points.center.y)/this.radius.fill,this.scale.outline.horizontal=(Math.max(this.points.p1.x,this.points.p2.x)+this.outlineWidth/2-this.points.center.x)/this.radius.outline,this.scale.outline.vertical=(Math.max(this.points.p1.y,this.points.p2.y)+this.outlineWidth/2-this.points.center.y)/this.radius.outline},this.addErasePoint=function(t){if(t.dragging){var a=this.erased.strokes[this.erased.strokes.length-1];a.points.push({x:t.mX,y:t.mY})}else this.erased.strokes.push({points:[{x:t.mX,y:t.mY}],strokeWidth:e.owner.TM.strokeWidth,strokeOpacity:e.owner.TM.strokeOpacity});return this.erased.strokes[this.erased.strokes.length-1]},this.undoErase=function(){this.erased.strokes.pop(),this.isBlank=!1},this.redoErase=function(t){this.erased.strokes.push(t)},this.draw=function(){if(!this.isBlank){var t=this.bigContext;t.clearRect(0,0,this.bigContext.canvas.width,this.bigContext.canvas.height);var a=parseInt(this.outlineWidth);this.fillOpacity>0&&(t.globalCompositeOperation="source-over",t.fillStyle=this.fillColor,t.globalAlpha=this.fillOpacity*this.layer.opacity,t.save(),t.scale(this.scale.fill.horizontal,this.scale.fill.vertical),t.beginPath(),t.arc(this.points.center.x/this.scale.fill.horizontal,this.points.center.y/this.scale.fill.vertical,this.radius.fill,0,2*Math.PI,!1),t.restore(),t.fill()),a*this.outlineOpacity>0&&(t.beginPath(),t.strokeStyle=this.outlineColor,t.lineWidth=a,t.globalAlpha=this.outlineOpacity*this.layer.opacity,t.save(),t.scale(this.scale.outline.horizontal,this.scale.outline.vertical),t.arc(this.points.center.x/this.scale.outline.horizontal,this.points.center.y/this.scale.outline.vertical,this.radius.outline,0,2*Math.PI,!1),t.restore(),t.stroke()),t.globalCompositeOperation="destination-out",this.erased.strokes.forEach(function(e){t.beginPath(),t.lineWidth=e.strokeWidth,t.globalAlpha=e.strokeOpacity,t.lineJoin="round",t.lineCap="round";for(var a=0;a<e.points.length;a++)0==a&&(t.moveTo(e.points[a].x,e.points[a].y),t.lineTo(e.points[a].x+.001,e.points[a].y)),t.lineTo(e.points[a].x,e.points[a].y);t.stroke()}),this.layer.previewContext.drawImage(this.bigCanvas[0],0,0),this.bigCanvas[0].toDataURL()==e.owner.LM.blankData&&(this.isBlank=!0)}},this.computePointsBounds=function(){var t=(this.bigContext,this.bounds.points);t.left=this.points.center.x,t.top=this.points.center.y,t.right=this.points.center.x+this.points.width,t.bottom=this.points.center.y+this.points.height},this},this.shapes={sbase:e.shapes,setShape:function(t){sbase=e.shapes,sbase.unsetShape();var a;switch(t.data.shape){case"rectangle":a=sbase.rectangleIcon,sbase.currShape="rectangle";break;case"oval":a=sbase.ovalIcon,sbase.currShape="oval"}a.addClass("canvasPaintImgButtonSelected"),sbase.drawPreview(e.owner.TM.currTool.brushToolPreview[0].getContext("2d"),e.owner.TM)},unsetShape:function(){if(sbase=e.shapes,sbase.currShape){var t;switch(sbase.currShape){case"rectangle":t=sbase.rectangleIcon;break;case"oval":t=sbase.ovalIcon}t.removeClass("canvasPaintImgButtonSelected")}},addShapeOptions:function(t){sbase=e.shapes,sbase.rectangleIcon=$("<img>").attr({src:"resources/rectangle.png",alt:"Rectangle",title:"Rectangle"}).addClass("canvasPaintImgButton").click({shape:"rectangle"},sbase.setShape),t.append(sbase.rectangleIcon),sbase.ovalIcon=$("<img>").attr({src:"resources/oval.png",alt:"Oval",title:"Oval"}).addClass("canvasPaintImgButton").click({shape:"oval"},sbase.setShape),t.append(sbase.ovalIcon)},createNew:function(t){switch(sbase.currShape){case"rectangle":return new e.owner.OF.rectangleObject(t);case"oval":return new e.owner.OF.ovalObject(t)}},drawPreview:function(t,e){switch(sbase.currShape){case"rectangle":sbase.drawRectanglePreview(t,e);break;case"oval":sbase.drawOvalPreview(t,e)}},drawRectanglePreview:function(t,e){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=e.fillColor,t.globalAlpha=e.fillOpacity,t.fillRect(30,30,90,90),e.outlineWidth*e.outlineOpacity>0&&(t.beginPath(),t.strokeStyle=e.outlineColor,t.lineWidth=e.outlineWidth,t.globalAlpha=e.outlineOpacity,t.moveTo(30-e.outlineWidth/2,30-e.outlineWidth/2),t.lineTo(120+e.outlineWidth/2,30-e.outlineWidth/2),t.lineTo(120+e.outlineWidth/2,120+e.outlineWidth/2),t.lineTo(30-e.outlineWidth/2,120+e.outlineWidth/2),t.closePath(),t.stroke())},drawOvalPreview:function(t,e){t.clearRect(0,0,t.canvas.width,t.canvas.height),t.fillStyle=e.fillColor,t.globalAlpha=e.fillOpacity,t.beginPath(),t.arc(75,75,45,0,2*Math.PI,!1),t.fill(),e.outlineWidth*e.outlineOpacity>0&&(t.beginPath(),t.globalAlpha=e.outlineOpacity,t.strokeStyle=e.outlineColor,t.lineWidth=e.outlineWidth,t.arc(75,75,45+e.outlineWidth/2,0,2*Math.PI,!1),t.stroke())}}}function CanvasPaintLayerManager(t){var e=this;e.owner=t,e.layers=[],e.blankData,e.addNewLayer=function(t){return e.owner.TM.addLayer.doAction({manager:e,order:t}),e.currLayer},e.useLayer=function(t){e.currLayer&&e.currLayer.dontUse(),Number.isInteger(t)?e.getLayer(t).use():t.use()},e.useLayerClicked=function(t){e.useLayer(t.data.layer)},e.getLayer=function(t){e.layers.forEach(function(e){return t==e.id?e:void 0})},e.layer=function(){var t=this;t.manager=e,t.id=0,t.order=0,t.opacity=1,t.erased=[],e.layers.forEach(function(e){t.id=Math.max(t.id,e.id),t.order=Math.max(t.order,e.order)}),e.layers.length&&(t.id+=1,t.order+=1),t.show=!0,t.canvasPaint=!1,t.currObj=void 0,t.genHTML=function(){t.miniLayerDiv=$("<div>").addClass("canvasPaintMiniLayerDiv").css("order",t.order).click({layer:t},e.useLayerClicked),e.owner.layersInnerDiv.append(t.miniLayerDiv),t.miniLayerDiv.append($("<strong>").html("Layer id: "+t.id));var a=$("<div>").addClass("canvasPaintLayerToolbar");t.miniLayerDiv.append(a),t.visibilityToggleButton=$("<img>").attr({src:"resources/openEye.png",alt:"Hide Layer",title:"Hide Layer"}).addClass("canvasPaintImgButton").click(t.toggleShow),a.append($("<div>").addClass("canvasPaintVisibilityToggleDiv").css("order",0).append(t.visibilityToggleButton)),a.append($("<span>").html("Clear").addClass("canvasPaintImgButton").css("order",1).click({layer:this},t.clear)),a.append($("<div>").addClass("canvasPaintImgButtonDiv").css("order",2).append($("<img>").attr({src:"resources/delete.png",alt:"Delete Layer",title:"Delete Layer"}).addClass("canvasPaintImgButton").click({layer:this},t.deleteLayer))),a.append($("<div>").addClass("canvasPaintImgButtonDiv").css("order",3).append($("<img>").attr({src:"resources/up.png",alt:"Move Layer Up",title:"Move Layer Up"}).addClass("canvasPaintImgButton").click({layer:this},t.moveUp))),a.append($("<div>").addClass("canvasPaintImgButtonDiv").css("order",4).append($("<img>").attr({src:"resources/down.png",alt:"Move Layer Down",title:"Move Layer Down"}).addClass("canvasPaintImgButton").click({layer:this},t.moveDown))),t.opacitySpan=$("<span>").html("100").addClass("canvasPaintValueSpan"),t.opacitySlider=$("<input>").attr({type:"range",min:0,max:100,value:100}).addClass("canvasPaintLayerOpacity").on("input change",t.opacityChange),a.append($("<div>").html("Layer Opacity: ").addClass("canvasPaintInputDiv").css("order",5).append(t.opacitySpan).append("%").append(t.opacitySlider)),t.previewCanvas=$("<canvas>").attr({height:e.owner.mainContext.canvas.height,width:e.owner.mainContext.canvas.width}).addClass("canvasPaintLayerPreviewCanvas"),t.miniLayerDiv.append(t.previewCanvas),t.previewContext=t.previewCanvas[0].getContext("2d")},t.actions=[],t.undone=[],t.objects=[],t.use=function(){t.miniLayerDiv.addClass("canvasPaintLelectedLayer"),e.currLayer=t},t.dontUse=function(){t.miniLayerDiv.removeClass("canvasPaintLelectedLayer")},t.clear=function(a){e.owner.TM.clear.doAction({layer:t})},t.deleteLayer=function(a){e.owner.TM.deleteLayer.doAction({layer:t})},t.moveUp=function(a){e.owner.TM.moveLayerUp.doAction({layer:t})},t.moveDown=function(a){e.owner.TM.moveLayerDown.doAction({layer:t})},t.opacityChange=function(a){var o=!0;"change"==a.type&&(o=!1),e.owner.TM.changeLayerOpacity.doAction({layer:t,dragging:o})},t.getObj=function(e){var a;for(a=0;a<t.objects.length;a++)if(t.objects[a].id==e)return t.objects[a]},t.redraw=function(){t.previewContext.clearRect(0,0,t.previewContext.canvas.width,t.previewContext.canvas.height),t.show&&t.objects.forEach(function(t){t.draw()})},t.drawOnGlobal=function(){t.show&&t.objects.forEach(function(t){t.drawOnContextAsImg(e.owner.mainContext)})},t.setOrder=function(e){t.order=e,t.miniLayerDiv.css("order",e),t.objects.forEach(function(t){t.setLayerOrder(e)})},t.toggleShow=function(){e.owner.TM.toggleLayerVisibility.doAction({layer:t})},t.genHTML()}}function CanvasPaintActionManager(t){this.owner=t,this.history=new Array,this.future=new Array,this.historyLimit=100,this.addToHistory=function(t){if(this.history.push(t),this.future.length>0&&(this.future.forEach(function(t){t.layer.undone=[]}),this.future=[]),this.history.length>this.historyLimit){var e=this.history.shift();e.layer.actions.shift()}},this.undo=function(){if(this.history.length>0){var t=this.history.pop();this.future.push(this.owner.TM.getTool(t.tool).undo(t))}},this.redo=function(){if(this.future.length>0){var t=this.future.pop();this.history.push(this.owner.TM.getTool(t.tool).redo(t))}}}function CanvasPaintToolManager(t){var e=this;e.owner=t,e.currTool,e.strokeColor=e.owner.options.strokeColor,e.strokeWidth=e.owner.options.strokeWidth,e.strokeOpacity=e.owner.options.strokeOpacity/100,e.fillColor=e.owner.options.fillColor,e.fillOpacity=e.owner.options.fillOpacity,e.outlineColor=e.owner.options.outlineColor,e.outlineWidth=e.owner.options.outlineWidth,e.outlineOpacity=e.owner.options.outlineOpacity/100,e.setTool=function(t){e.currTool&&e.currTool.unselect(),t.data.tool.select()},e.getTool=function(t){switch(t){case"paint":return e.paint;case"eraser":return e.eraser;case"shape":return e.shape;case"clear":return e.clear;case"addLayer":return e.addLayer;case"toggleLayerVisibility":return e.toggleLayerVisibility;case"deleteLayer":return e.deleteLayer;case"moveLayerUp":return e.moveLayerUp;case"moveLayerDown":return e.moveLayerDown;case"changeLayerOpacity":return e.changeLayerOpacity}},e.setUpTools=function(){e.toolNameSpan=$("<span>"),e.owner.outerToolDiv.append(e.toolNameSpan).append(" Settings"),e.scrollingToolDiv=$("<div>").addClass("canvasPaintToolsScrollingDiv"),e.owner.outerToolDiv.append(e.scrollingToolDiv),e.addTopToolBar(),e.addExportTools(0),e.addHistoryTools(1),e.addDrawingIcons(2),e.setTool({data:{tool:e.getTool(e.owner.options.currTool)}})},e.addTopToolBar=function(){e.topToolbar=$("<div>").addClass("canvasPaintTopToolbar"),e.owner.topSect.append(e.topToolbar)},e.addExportTools=function(t){e.exportToolGroup=$("<div>").addClass("canvasPaintToolGroup").css("order",t),e.topToolbar.append(e.exportToolGroup),e["export"].addIcon(0)},e.addHistoryTools=function(t){e.historyToolGroup=$("<div>").addClass("canvasPaintToolGroup").css("order",t),e.topToolbar.append(e.historyToolGroup),e.history.addIcon(0)},e.addDrawingIcons=function(t){e.drawingToolsGroup=$("<div>").addClass("canvasPaintToolGroup").css("order",t),e.topToolbar.append(e.drawingToolsGroup),e.paint.addIcon(0),e.eraser.addIcon(1),e.shape.addIcon(2)},e.paint={doAction:function(t){var a=t.layer;if(a.show&&(0!=a.objects.length&&!t.dragging&&a.type&&"paint"!=a.type&&(a.canvasPaint=!1,e.owner.LM.addNewLayer(a.order+1),t.layer=e.owner.LM.currLayer,a=e.owner.LM.currLayer,a.canvasPaint=!0),t.tool="paint",0==a.objects.length?(t.order=0,a.type="paint",a.objects.push(new e.owner.OF.paintObject(t)),a.currObj=a.objects[0]):a.currObj.addPoint(t),a.redraw(),!t.dragging)){var o={tool:"paint",layer:t.layer,obj:a.currObj,stroke:a.currObj.strokes[a.currObj.strokes.length-1]};a.actions.push(o),e.owner.AM.addToHistory({tool:"paint",layer:t.layer})}},undo:function(t){var e=t.layer.actions.pop();return 1==e.obj.strokes.length?(e.obj.delCanvas(),e.layer.type=void 0,e.layer.objects.pop()):e.obj.strokes.pop(),t.layer.undone.push(e),t.layer.redraw(),t},redo:function(t){var e=t.layer.undone.pop();return e.stroke==e.obj.strokes[0]?(e.layer.objects.push(e.obj),e.obj.genCanvas(),e.layer.type="paint"):e.obj.strokes.push(e.stroke),t.layer.actions.push(e),t.layer.redraw(),t},select:function(t){var a=e.paint;a.innerToolDiv=$("<div>").addClass("canvasPaintToolsInnerDiv"),e.scrollingToolDiv.append(a.innerToolDiv);var o=$("<div>").addClass("canvasPaintToolOptionDiv").css("order",0);a.innerToolDiv.append(o.append($("<label>").html("Stroke Color: "))),a.strokeColor=$("<input>").attr({type:"color",value:e.strokeColor}).addClass("canvasPaintStrokeOption").on("input change",a.brushAdjusted),o.append(a.strokeColor);var n=$("<div>").css("Order",1).addClass("canvasPaintToolOptionDiv");a.innerToolDiv.append(n),n.append($("<label>").html("Stroke Width: ")),a.strokeWidthSpan=$("<span>"),n.append(a.strokeWidthSpan).append("<br>"),a.strokeWidth=$("<input>").attr({type:"range",max:150,min:0,value:e.strokeWidth}).addClass("canvasPaintSlider"),n.append(a.strokeWidth),a.strokeWidth.on("input change",a.brushAdjusted),n.append("<br>"),n.append($("<label>").html("Stroke Opacity: ")),a.strokeOpacitySpan=$("<span>"),n.append(a.strokeOpacitySpan).append("%<br>"),a.strokeOpacity=$("<input>").attr({type:"range",max:100,min:0,value:100*e.strokeOpacity}).addClass("canvasPaintSlider"),n.append(a.strokeOpacity),a.strokeOpacity.on("input change",a.brushAdjusted),a.brushToolPreview=$("<canvas>").attr({height:150,width:150}).addClass("canvasPaintBrushPreview"),a.innerToolDiv.append($("<div>").addClass("canvasPaintToolOptionDiv canvasPaintCenter").css("order",3).append(a.brushToolPreview)),a.brushAdjusted(),a.icon.addClass("canvasPaintImgButtonSelected"),e.toolNameSpan.html("Paint Brush"),e.currTool=a},unselect:function(){var t=e.paint;t.icon.removeClass("canvasPaintImgButtonSelected"),t.innerToolDiv.remove()},addIcon:function(t){pbase=e.paint,pbase.icon=$("<img>").css("order",t).attr({src:"resources/brush.png",alt:"Paint Brush",title:"Paint Brush"}).addClass("canvasPaintImgButton").click({tool:pbase},e.setTool),e.drawingToolsGroup.append(pbase.icon)},brushAdjusted:function(t){var a=e.paint;e.strokeColor=a.strokeColor.val(),e.strokeWidth=a.strokeWidth.val(),e.strokeOpacity=a.strokeOpacity.val()/100,a.strokeWidthSpan.html(e.strokeWidth),a.strokeOpacitySpan.html(a.strokeOpacity.val());var o=a.brushToolPreview[0].getContext("2d");o.clearRect(0,0,o.canvas.width,o.canvas.height),o.fillStyle=e.strokeColor,o.globalAlpha=e.strokeOpacity,o.beginPath(),o.arc(o.canvas.width/2,o.canvas.height/2,e.strokeWidth/2,0,2*Math.PI),o.fill()},drawTool:function(){e.owner.mainContext.fillStyle=e.strokeColor,e.owner.mainContext.globalAlpha=e.strokeOpacity,e.owner.mainContext.beginPath(),e.owner.mainContext.arc(e.owner.mousePosition.x,e.owner.mousePosition.y,e.strokeWidth/2,0,2*Math.PI),e.owner.mainContext.fill()}},e.eraser={doAction:function(t){var a=(e.eraser,t.layer);if(a.show&&0!=a.objects.length){t.tool="eraser";var o=a.currObj.addErasePoint(t);if(a.redraw(),!t.dragging){var n={tool:"eraser",layer:t.layer,obj:a.currObj,stroke:o};a.actions.push(n),e.owner.AM.addToHistory({tool:"eraser",layer:t.layer})}}},undo:function(t){var e=t.layer.actions.pop();return e.obj.undoErase(),e.obj.isBlank=!1,t.layer.undone.push(e),t.layer.redraw(),t},redo:function(t){var e=t.layer.undone.pop();return e.obj.redoErase(e.stroke),t.layer.actions.push(e),t.layer.redraw(),t},select:function(t){var a=e.eraser;a.innerToolDiv=$("<div>").addClass("canvasPaintToolsInnerDiv"),e.scrollingToolDiv.append(a.innerToolDiv);var o=$("<div>").css("Order",1).addClass("canvasPaintToolOptionDiv");a.innerToolDiv.append(o),o.append($("<label>").html("Stroke Width: ")),a.strokeWidthSpan=$("<span>"),o.append(a.strokeWidthSpan).append("<br>"),a.strokeWidth=$("<input>").attr({type:"range",max:150,min:0,value:e.strokeWidth}).addClass("canvasPaintSlider"),o.append(a.strokeWidth),a.strokeWidth.on("input change",a.brushAdjusted),o.append("<br>"),o.append($("<label>").html("Stroke Opacity: ")),a.strokeOpacitySpan=$("<span>"),o.append(a.strokeOpacitySpan).append("%<br>"),a.strokeOpacity=$("<input>").attr({type:"range",max:100,min:0,value:100*e.strokeOpacity}).addClass("canvasPaintSlider"),o.append(a.strokeOpacity),a.strokeOpacity.on("input change",a.brushAdjusted),a.brushToolPreview=$("<canvas>").attr({height:150,width:150}).addClass("canvasPaintBrushPreview"),a.innerToolDiv.append($("<div>").addClass("canvasPaintToolOptionDiv canvasPaintCenter").css("order",3).append(a.brushToolPreview)),a.brushAdjusted(),a.icon.addClass("canvasPaintImgButtonSelected"),e.toolNameSpan.html("Eraser"),e.currTool=a},unselect:function(){var t=e.eraser;t.icon.removeClass("canvasPaintImgButtonSelected"),t.innerToolDiv.remove()},addIcon:function(t){var a=e.eraser;a.icon=$("<img>").css("order",t).attr({src:"resources/eraser.png",alt:"Eraser",title:"Eraser"}).addClass("canvasPaintImgButton").click({tool:a},e.setTool),e.drawingToolsGroup.append(a.icon)},brushAdjusted:function(t){var a=e.eraser;e.strokeWidth=a.strokeWidth.val(),e.strokeOpacity=a.strokeOpacity.val()/100,a.strokeWidthSpan.html(e.strokeWidth),a.strokeOpacitySpan.html(a.strokeOpacity.val());var o=a.brushToolPreview[0].getContext("2d");o.clearRect(0,0,o.canvas.width,o.canvas.height),o.fillStyle="#000000",o.globalAlpha=e.strokeOpacity,o.beginPath(),o.arc(o.canvas.width/2,o.canvas.height/2,e.strokeWidth/2,0,2*Math.PI),o.fill()},drawTool:function(){e.owner.mainContext.fillStyle="#000000",e.owner.mainContext.globalAlpha=e.strokeOpacity,e.owner.mainContext.beginPath(),e.owner.mainContext.arc(e.owner.mousePosition.x,e.owner.mousePosition.y,e.strokeWidth/2,0,2*Math.PI),e.owner.mainContext.fill()}},e.shape={doAction:function(t){t.tool="shape";var a=e.shape,o=t.layer;if(o.show&&(0==o.objects.length||t.dragging||(o.canvasPaint=!1,e.owner.LM.addNewLayer(o.order+1),t.layer=e.owner.LM.currLayer,o=e.owner.LM.currLayer,o.canvasPaint=!0),0!=o.objects.length||t.dragging?"shape"==o.type&&o.currObj.updateShape(t):(t.order=0,o.type="shape",o.objects.push(a.shapes.createNew(t)),o.currObj=o.objects[0]),o.redraw(),!t.dragging)){var n={tool:"shape",layer:t.layer,obj:o.currObj};o.actions.push(n),e.owner.AM.addToHistory({tool:"shape",layer:t.layer})}},undo:function(t){var e=t.layer.actions.pop();return e.obj.delCanvas(),e.layer.type=void 0,e.layer.objects.pop(),t.layer.undone.push(e),t.layer.redraw(),t},redo:function(t){var e=t.layer.undone.pop();return e.layer.objects.push(e.obj),e.obj.genCanvas(),e.layer.type="shape",t.layer.actions.push(e),t.layer.redraw(),t},select:function(t){var a=e.shape;a.innerToolDiv=$("<div>").addClass("canvasPaintToolsInnerDiv"),e.scrollingToolDiv.append(a.innerToolDiv),a.shapes=e.owner.OF.shapes,a.shapeSelectDiv=$("<div>").addClass("canvasPaintToolOptionDiv").css("order",0),a.innerToolDiv.append(a.shapeSelectDiv),a.shapes.addShapeOptions(a.shapeSelectDiv),a.shapes.setShape({data:{shape:"rectangle"}});var o=$("<div>").addClass("canvasPaintToolOptionDiv").css("order",0);a.innerToolDiv.append(o.append($("<label>").html("Fill Color: "))),a.fillColor=$("<input>").attr({type:"color",value:e.fillColor}).addClass("canvasPaintoutlineOption").on("input change",a.brushAdjusted),o.append(a.fillColor);var n=$("<div>").css("Order",1).addClass("canvasPaintToolOptionDiv");a.innerToolDiv.append(n),n.append($("<label>").html("Fill Opacity: ")),a.fillOpacitySpan=$("<span>"),n.append(a.fillOpacitySpan).append("%<br>"),a.fillOpacity=$("<input>").attr({type:"range",max:100,min:0,value:100*e.fillOpacity}).addClass("canvasPaintSlider"),n.append(a.fillOpacity),a.fillOpacity.on("input change",a.brushAdjusted);var i=$("<div>").addClass("canvasPaintToolOptionDiv").css("order",0);a.innerToolDiv.append(i.append($("<label>").html("outline Color: "))),a.outlineColor=$("<input>").attr({type:"color",value:e.outlineColor}).addClass("canvasPaintoutlineOption").on("input change",a.brushAdjusted),i.append(a.outlineColor);var s=$("<div>").css("Order",1).addClass("canvasPaintToolOptionDiv");a.innerToolDiv.append(s),s.append($("<label>").html("outline Width: ")),a.outlineWidthSpan=$("<span>"),s.append(a.outlineWidthSpan).append("<br>"),a.outlineWidth=$("<input>").attr({type:"range",max:25,min:0,value:e.outlineWidth}).addClass("canvasPaintSlider"),s.append(a.outlineWidth),a.outlineWidth.on("input change",a.brushAdjusted),s.append("<br>"),s.append($("<label>").html("outline Opacity: ")),a.outlineOpacitySpan=$("<span>"),s.append(a.outlineOpacitySpan).append("%<br>"),a.outlineOpacity=$("<input>").attr({type:"range",max:100,min:0,value:100*e.outlineOpacity}).addClass("canvasPaintSlider"),s.append(a.outlineOpacity),a.outlineOpacity.on("input change",a.brushAdjusted),a.brushToolPreview=$("<canvas>").attr({height:150,width:150}).addClass("canvasPaintBrushPreview"),a.innerToolDiv.append($("<div>").addClass("canvasPaintToolOptionDiv canvasPaintCenter").css("order",3).append(a.brushToolPreview)),a.brushAdjusted(),a.icon.addClass("canvasPaintImgButtonSelected"),e.toolNameSpan.html("Shape Tool"),e.currTool=a},unselect:function(){var t=e.shape;t.icon.removeClass("canvasPaintImgButtonSelected"),t.innerToolDiv.remove()},addIcon:function(t){var a=e.shape;a.icon=$("<img>").css("order",t).attr({src:"resources/shapes.png",alt:"Shapes",title:"Shapes"}).addClass("canvasPaintImgButton").click({tool:a},e.setTool),e.drawingToolsGroup.append(a.icon)},brushAdjusted:function(){var t=e.shape;e.fillColor=t.fillColor.val(),e.fillOpacity=t.fillOpacity.val()/100,e.outlineColor=t.outlineColor.val(),e.outlineWidth=parseInt(t.outlineWidth.val()),e.outlineOpacity=t.outlineOpacity.val()/100,t.outlineWidthSpan.html(e.outlineWidth),t.fillOpacitySpan.html(t.fillOpacity.val()),t.outlineOpacitySpan.html(t.outlineOpacity.val()),t.shapes.drawPreview(t.brushToolPreview[0].getContext("2d"),e)},drawTool:function(){var t=e.owner.mainContext,a=e.owner.mousePosition,o=15,n=3;t.strokeStyle="#000000",t.lineWidth=2,t.globalAlpha=1,t.beginPath(),t.moveTo(a.x-n,a.y),t.lineTo(a.x-o,a.y),t.stroke(),t.beginPath(),t.moveTo(a.x,a.y-n),t.lineTo(a.x,a.y-o),t.stroke(),t.beginPath(),t.moveTo(a.x+n,a.y),t.lineTo(a.x+o,a.y),t.stroke(),t.beginPath(),t.moveTo(a.x,a.y+n),t.lineTo(a.x,a.y+o),t.stroke()}},e.addLayer={doAction:function(t){var a=t.manager;if(t.order){a.layers.splice(t.order,0,new a.layer),a.useLayer(a.layers[t.order]);for(var o=t.order;o<a.layers.length;o++)a.layers[o].setOrder(o)}else a.layers.push(new a.layer),a.useLayer(a.layers[a.layers.length-1]);a.currLayer.actions.push({
tool:"addLayer",layer:a.currLayer}),e.owner.AM.addToHistory({tool:"addLayer",layer:a.currLayer})},undo:function(t){var e=t.layer,a=(e.manager,e.actions.pop());e.miniLayerDiv.remove();var o,n=!1,i=e.manager.currLayer.id==e.id;for(o=0;o<e.manager.layers.length;o++)e.manager.layers[o].id==e.id&&(e.manager.layers.splice(o,1),n=!0,i&&(0!=o?e.manager.useLayer(e.manager.layers[o-1]):o<e.manager.layers.length?e.manager.useLayer(e.manager.layers[o]):e.manager.currLayer=void 0)),n&&o<e.manager.layers.length&&e.manager.layers[o].setOrder(o);return e.undone.push(a),t},redo:function(t){var e=t.layer,a=e.manager,o=e.undone.pop();e.manager.layers.splice(e.order,0,e),e.genHTML();for(var n=0;n<e.manager.layers.length;n++)e.manager.layers[n].setOrder(n);return o.wasCurr&&e.manager.useLayer(e),a.useLayer(e),e.redraw(),e.actions.push(o),t}},e.toggleLayerVisibility={doAction:function(t){lbase=t.layer,this.action(lbase),lbase.actions.push({tool:"toggleLayerVisibility",layer:lbase}),e.owner.AM.addToHistory({tool:"toggleLayerVisibility",layer:lbase})},undo:function(t){return lbase=t.layer,this.action(lbase),lbase.undone.push(lbase.actions.pop()),t},redo:function(t){return lbase=t.layer,this.action(lbase),lbase.actions.push(lbase.undone.pop()),t},action:function(t){t.show=!t.show,t.show?(t.visibilityToggleButton.attr("src","resources/openEye.png"),t.objects.forEach(function(t){t.show()})):(t.visibilityToggleButton.attr("src","resources/closedEye.png"),t.objects.forEach(function(t){t.hide()}))}},e.clear={doAction:function(t){t.layer.actions.push({tool:"clear",objects:t.layer.objects.slice(),erased:t.layer.erased.slice()}),t.layer.objects.forEach(function(t){t.delCanvas()}),t.layer.objects=[],t.layer.erased=[],e.owner.AM.addToHistory({tool:"clear",layer:t.layer}),t.layer.redraw()},undo:function(t){var e=t.layer.actions.pop();return t.layer.objects=e.objects,t.layer.erased=e.erased,t.layer.objects.forEach(function(t){t.genCanvas()}),t.layer.undone.push({tool:"clear"}),t.layer.redraw(),{tool:"clear",layer:t.layer}},redo:function(t){t.layer.undone.pop();return t.layer.actions.push({tool:"clear",objects:t.layer.objects.slice(),erased:t.layer.erased.slice()}),t.layer.objects.forEach(function(t){t.delCanvas()}),t.layer.objects=[],t.layer.redraw(),{tool:"clear",layer:t.layer}}},e.deleteLayer={doAction:function(t){t.layer.miniLayerDiv.remove();for(var a=!1,o=t.layer.manager.currLayer.id==t.layer.id,n=0;n<t.layer.manager.layers.length;n++)t.layer.manager.layers[n].id==t.layer.id&&(t.layer.manager.layers.splice(n,1),a=!0,o&&(0!=n?t.layer.manager.useLayer(t.layer.manager.layers[n-1]):n<t.layer.manager.layers.length?t.layer.manager.useLayer(t.layer.manager.layers[n]):t.layer.manager.currLayer=void 0)),a&&n<t.layer.manager.layers.length&&t.layer.manager.layers[n].setOrder(n);t.layer.objects.forEach(function(t){t.delCanvas()}),t.layer.actions.push({tool:"deleteLayer",layer:t.layer,wasCurr:o}),e.owner.AM.addToHistory({tool:"deleteLayer",layer:t.layer})},undo:function(t){var e=t.layer.actions.pop();e.layer.manager.layers.splice(e.layer.order,0,e.layer),e.layer.genHTML(),e.layer.objects.forEach(function(t){t.genCanvas()}),e.layer.undone.push(e);for(var a=0;a<e.layer.manager.layers.length;a++)e.layer.manager.layers[a].setOrder(a);return e.wasCurr&&e.layer.manager.useLayer(e.layer),e.layer.redraw(),t},redo:function(t){var e=t.layer.undone.pop();e.layer.miniLayerDiv.remove();var a,o=!1,n=e.layer.manager.currLayer.id==e.layer.id;for(a=0;a<e.layer.manager.layers.length;a++)e.layer.manager.layers[a].id==e.layer.id&&(e.layer.manager.layers.splice(a,1),o=!0,n&&(0!=a?e.layer.manager.useLayer(e.layer.manager.layers[a-1]):a<e.layer.manager.layers.length?e.layer.manager.useLayer(e.layer.manager.layers[a]):e.layer.manager.currLayer=void 0)),o&&a<e.layer.manager.layers.length&&e.layer.manager.layers[a].setOrder(a);return e.layer.objects.forEach(function(t){t.delCanvas()}),e.layer.actions.push(e),t}},e.moveLayerUp={doAction:function(t){for(var a=t.layer,o=a.manager,n=0;n<o.layers.length;n++)if(o.layers[n].id==a.id&&n<o.layers.length-1)return o.layers[n]=o.layers[n+1],o.layers[n+1]=a,a.setOrder(n+1),o.layers[n].setOrder(n),a.actions.push({tool:"moveLayerUp",layer:a}),void e.owner.AM.addToHistory({tool:"moveLayerUp",layer:a})},undo:function(t){for(var e=t.layer,a=e.manager,o=e.actions.pop(),n=0;n<a.layers.length;n++)if(a.layers[n].id==e.id&&n>0)return a.layers[n]=a.layers[n-1],a.layers[n-1]=e,e.setOrder(n-1),a.layers[n].setOrder(n),e.undone.push(o),t},redo:function(t){for(var e=t.layer,a=e.manager,o=e.undone.pop(),n=0;n<a.layers.length;n++)if(a.layers[n].id==e.id&&n<a.layers.length-1)return a.layers[n]=a.layers[n+1],a.layers[n+1]=e,e.setOrder(n+1),a.layers[n].setOrder(n),e.actions.push(o),t}},e.moveLayerDown={doAction:function(t){for(var a=t.layer,o=a.manager,n=0;n<o.layers.length;n++)if(o.layers[n].id==a.id&&n>0)return o.layers[n]=o.layers[n-1],o.layers[n-1]=a,a.setOrder(n-1),o.layers[n].setOrder(n),a.actions.push({tool:"moveLayerDown",layer:a}),void e.owner.AM.addToHistory({tool:"moveLayerDown",layer:a})},undo:function(t){for(var e=t.layer,a=e.manager,o=e.actions.pop(),n=0;n<a.layers.length;n++)if(a.layers[n].id==e.id&&n<a.layers.length-1)return a.layers[n]=a.layers[n+1],a.layers[n+1]=e,e.setOrder(n+1),a.layers[n].setOrder(n),e.undone.push(o),t},redo:function(t){for(var e=t.layer,a=e.manager,o=e.undone.pop(),n=0;n<a.layers.length;n++)if(a.layers[n].id==e.id&&n>0)return a.layers[n]=a.layers[n-1],a.layers[n-1]=e,e.setOrder(n-1),a.layers[n].setOrder(n),e.actions.push(o),t}},e.changeLayerOpacity={doAction:function(t){var a=t.layer,o=a.opacitySlider.val()/100,n=a.actions[a.actions.length-1];t.dragging?n&&"changeLayerOpacity"==n.tool&&n.dragging?n.valueTo=o:(a.actions.push({tool:"changeLayerOpacity",dragging:!0,valueTo:o,valueFrom:a.opacity}),e.owner.AM.addToHistory({tool:"changeLayerOpacity",layer:a})):"changeLayerOpacity"==n.tool&&n.dragging?(n.valueTo=o,n.dragging=!1):(a.actions.push({tool:"changeLayerOpacity",dragging:!1,valueTo:o,valueFrom:a.opacity}),e.owner.AM.addToHistory({tool:"changeLayerOpacity",layer:a})),a.objects.forEach(function(t){t.isBlank=!1}),a.opacity=o,a.opacitySpan.html(a.opacitySlider.val()),a.redraw()},undo:function(t){var e=t.layer,a=e.actions.pop();return console.log(a),e.opacity=a.valueFrom,e.opacitySpan.html(Math.round(100*a.valueFrom)),e.opacitySlider.val(100*a.valueFrom),e.undone.push(a),e.redraw(),t},redo:function(t){var e=t.layer,a=e.undone.pop();return console.log(a),e.opacity=a.valueTo,e.opacitySpan.html(Math.round(100*a.valueTo)),e.opacitySlider.val(100*a.valueTo),e.actions.push(a),e.redraw(),t}},e["export"]={addIcon:function(t){var a=e["export"];e.exportToolGroup.append($("<label>").html("Export as:")),a.exportFilename=$("<input>").attr({type:"text",placeholder:"drawing"}).addClass("canvasPaintExportFilename"),e.exportToolGroup.append(a.exportFilename),e.exportToolGroup.append(".png"),a.exportButton=$("<span>").html("Export").addClass("canvasPaintImgButton").click(a.exportDrawing),e.exportToolGroup.append(a.exportButton)},exportDrawing:function(t){var a=e["export"],o=e.owner;o.mainContext.clearRect(0,0,o.mainContext.canvas.width,o.mainContext.canvas.height),o.mainContext.globalAlpha=1,o.LM.layers.forEach(function(t){t.drawOnGlobal()}),o.mainCanvas[0].toBlobHD(function(t){saveAs(t,(a.exportFilename.val()||a.exportFilename.attr("placeholder"))+".png")},"image/png"),o.mainContext.clearRect(0,0,o.mainContext.canvas.width,o.mainContext.canvas.height)}},e.history={addIcon:function(t){var a=e.history;e.historyToolGroup.append($("<img>").css("order",0).addClass("canvasPaintImgButton").attr({src:"resources/undo.png",alt:"Undo",title:"Undo"}).click(a.undo)).append($("<img>").css("order",1).addClass("canvasPaintImgButton").attr({src:"resources/redo.png",alt:"Redo",title:"Redo"}).click(a.redo)),$("body").keydown(a.keyDown)},undo:function(t){e.owner.AM.undo()},redo:function(t){e.owner.AM.redo()},keyDown:function(t){t=t||window.event;var a=e.history;90!=t.which&&90!=t.keyCode||!t.ctrlKey?89!=t.which&&89!=t.keyCode||!t.ctrlKey||a.redo():a.undo()}}}!function(t,e,a){t.boglePlugin||(t.boglePlugin={});var o=t("<link>");t("head").append(o),o.attr({rel:"stylesheet",type:"text/css",href:"resources/canvasPaint.css"}),t.boglePlugin.drawing=function(e,a,o){var n=this;n.$el=t(e),n.el=e,n.$el.data("boglePlugin.drawing",n),n.init=function(){n.functionParam=a,n.options=t.extend({},t.boglePlugin.drawing.defaultOptions,o),n.mousePosition={},n.AM=new CanvasPaintActionManager(n),n.TM=new CanvasPaintToolManager(n),n.OF=new CanvasPaintObjectFactory(n),n.LM=new CanvasPaintLayerManager(n);var e=t("<section>").addClass("canvasPaintMain");n.$el.append(e),n.topSect=t("<section>").addClass("canvasPaintTopSect"),e.append(n.topSect);var i=t("<section>").addClass("canvasPaintMiddleSect");e.append(i);var s=t("<div>").addClass("canvasPaintLayersOuterDiv").css("order",0);i.append(s),s.append(t("<strong>").html("Layers ")),n.addNewLayerButton=t("<img>").attr({src:"resources/add.png",alt:"Add New Layer",title:"Add New Layer"}).addClass("canvasPaintImgButton"),s.append(n.addNewLayerButton),n.addNewLayerButton.click(n.addNewLayer);var r=t("<div>").addClass("canvasPaintLayersScrollingDiv");s.append(r),n.layersInnerDiv=t("<div>").addClass("canvasPaintLayersInnerDiv"),r.append(n.layersInnerDiv),n.canvasDiv=t("<div>").addClass("canvasPaintMainCanvasDiv").css("order",1),n.canvasScrollingDiv=t("<div>").addClass("canvasPaintMainCanvasScrollingDiv"),n.canvasInnerDiv=t("<div>").addClass("canvasPaintMainCanvasInnerDiv"),n.canvasDiv.append(n.canvasScrollingDiv.append(n.canvasInnerDiv)),i.append(n.canvasDiv),n.mainCanvas=t("<canvas>").attr({height:n.options.canvHeight,width:n.options.canvWidth}).addClass("canvasPaintMainCanvas"),n.canvasInnerDiv.append(n.mainCanvas),n.mainContext=n.mainCanvas[0].getContext("2d"),n.mainCanvas.on("mousedown mousemove touchstart touchmove",n.canvasMouseDownMove),n.mainCanvas.on("mouseup mouseleave touchend",n.canvasMouseUpLeave),n.mainCanvas.on("contextmenu",n.canvasContextMenu),n.outerToolDiv=t("<div>").addClass("canvasPaintToolsOuterDiv").css("order",2),i.append(n.outerToolDiv),n.LM.blankData=n.mainCanvas[0].toDataURL(),t("body").keydown(n.keyDown),n.addNewLayer(),n.TM.setUpTools(),n.AM.history.pop(),n.LM.layers[0].actions.pop(),console.log("Canvas Paint: Ready to draw!")},n.addNewLayer=function(){n.LM.addNewLayer()},n.undo=function(t){n.AM.undo()},n.redo=function(t){n.AM.redo()},n.getMousePosition=function(t){if("mouseleave"==t.type)return void(n.mousePosition.offCanvas=!0);n.mousePosition.offCanvas=!1;var e=n.mainCanvas[0].getBoundingClientRect();"touchstart"==t.type||"touchmove"==t.type?(n.mousePosition.x=t.originalEvent.changedTouches[0].clientX-e.left,n.mousePosition.y=t.originalEvent.changedTouches[0].clientY-e.top):(n.mousePosition.x=t.clientX-e.left,n.mousePosition.y=t.clientY-e.top)},n.canvasMouseDownMove=function(t){if(t.preventDefault(),n.getMousePosition(t),!(t.which>1)){var e;"mousedown"==t.type||"touchstart"==t.type?(e=!1,n.LM.currLayer.canvasPaint=!0):("mousemove"==t.type||"touchmove"==t.type)&&(e=!0);var a={layer:n.LM.currLayer,mX:n.mousePosition.x,mY:n.mousePosition.y,dragging:e};n.LM.currLayer.canvasPaint&&n.TM.currTool.doAction(a),n.redrawBrush()}},n.canvasMouseUpLeave=function(t){n.LM.currLayer.canvasPaint&&t.which<=1&&(n.LM.currLayer.canvasPaint=!1),n.getMousePosition(t),n.redrawBrush()},this.canvasContextMenu=function(t){t.preventDefault()},n.drawBrush=function(){n.mousePosition.offCanvas||n.TM.currTool.drawTool()},n.redrawBrush=function(){n.mainContext.clearRect(0,0,n.mainContext.canvas.width,n.mainContext.canvas.height),n.drawBrush()},n.init()},t.boglePlugin.drawing.defaultOptions={canvWidth:700,canvHeight:394,currTool:"paint",strokeColor:"#ff0000",strokeWidth:20,strokeOpacity:100,fillColor:"#ff0000",fillOpacity:100,outlineColor:"#000000",outlineWidth:2,outlineOpacity:100},t.fn.boglePlugin_drawing=function(e,a){return this.each(function(){new t.boglePlugin.drawing(this,e,a)})},t(e).ready(function(){t(".canvasPaint").boglePlugin_drawing()})}(jQuery);